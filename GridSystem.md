
# GridSystem

## Описание

**GridSystem** — это мощный и гибкий модуль для процедурной генерации и управления игровыми полями на основе сетки. Он подходит для создания как 2D, так и 3D миров и может служить основой для пошаговых стратегий, головоломок, тактических игр и многого другого. Система позволяет не только генерировать сетку, но и находить пути, размещать объекты и визуализировать структуру поля для отладки.

## Ключевые компоненты

### `FieldGenerator`
**Пространство имен:** `Neo.GridSystem`

Это центральный класс-синглтон, который управляет всем жизненным циклом сетки. Он отвечает за создание поля, предоставление доступа к ячейкам и реализацию поиска пути.

- **Как использовать**: Добавьте этот компонент на `GameObject` на сцене. Он автоматически получит доступ к компоненту `Grid`, который должен находиться на том же объекте.
- **Свойства**:
  - `Config` (`FieldGeneratorConfig`): Конфигурация, используемая для генерации поля.
  - `Cells` (`FieldCell[,,]`): Трехмерный массив, содержащий все ячейки поля.
  - `Cells2D` (`FieldCell[,]`): Удобный доступ к 2D-срезу массива ячеек (где Z=0).
  - `UnityGrid` (`Grid`): Ссылка на стандартный компонент `Grid` от Unity.
- **Ключевые методы**:
  - `GenerateField()`: Создает сетку на основе `Config`.
  - `GetCell(Vector3Int pos)`: Возвращает ячейку по ее координатам.
  - `GetCellFromWorld(Vector3 worldPos)`: Возвращает ячейку по мировым координатам.
  - `GetNeighbors(FieldCell cell)`: Возвращает список соседних ячеек на основе правил из `MovementRule`.
  - `FindPath(Vector3Int start, Vector3Int end)`: Находит кратчайший путь между двумя ячейками (простая реализация BFS).
- **Unity Events**:
  - `OnFieldGenerated`: Вызывается после успешной генерации поля.
  - `OnCellChanged`: Вызывается при изменении данных ячейки. Передает измененную ячейку `FieldCell`.

### `FieldGeneratorConfig`
**Пространство имен:** `Neo.GridSystem`

Класс, содержащий настройки для генератора поля. Может быть настроен прямо в инспекторе компонента `FieldGenerator`.

- **Свойства**:
  - `Size` (`Vector3Int`): Размер генерируемого поля по трем осям.
  - `MovementRule` (`MovementRule`): Правила определения соседних ячеек.

### `FieldCell`
**Пространство имен:** `Neo.GridSystem`

Простой класс, представляющий одну ячейку в сетке.

- **Свойства**:
  - `Position` (`Vector3Int`): Координаты ячейки.
  - `Type` (`int`): Пользовательский тип ячейки (например, для разных типов ландшафта).
  - `IsWalkable` (`bool`): Флаг, определяющий, можно ли через эту ячейку проложить путь.
  - `UserData` (`object`): Поле для хранения любых дополнительных данных.

### `MovementRule`
**Пространство имен:** `Neo.GridSystem`

Определяет, как связаны ячейки на сетке. Содержит список смещений для поиска соседей. Включает в себя несколько готовых статических пресетов:
- `FourDirections2D`: 4 направления (крест).
- `EightDirections2D`: 8 направлений (крест и диагонали).
- `SixDirections3D`: 6 направлений в 3D (вверх, вниз, вправо, влево, вперед, назад).
- И другие, включая гексагональные и полные 3D-наборы (26 направлений).

## Размещение объектов

### `FieldSpawner` и `FieldObjectSpawner`
Эти два компонента предназначены для размещения префабов на сгенерированной сетке. Оба требуют наличия `FieldGenerator` на том же объекте.

- **`FieldSpawner`**: Простой спаунер. Позволяет разместить префаб в указанной ячейке.
- **`FieldObjectSpawner`**: Более продвинутая версия. Он не только размещает объекты, но и отслеживает их. Он знает, какие объекты находятся в какой ячейке, и поддерживает флаг `occupiesSpace`, который позволяет отметить, что объект "занимает" ячейку (например, делая ее непроходимой). Содержит события `OnObjectSpawned`, `OnObjectRemoved`, `OnCellOccupied`, `OnCellFreed`.

## Отладка и визуализация

### `FieldDebugDrawer`
Очень полезный компонент для отладки. Используя `Gizmos`, он рисует в окне `Scene`:
- Границы сетки.
- Цветовую индикацию ячеек (проходимая/непроходимая).
- Координаты каждой ячейки.
- Тестовые пути (`DebugPath`).

Просто добавьте его на тот же `GameObject`, где находится `FieldGenerator`, и включите `DebugEnabled` в генераторе.
