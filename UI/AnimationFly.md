# Менеджер анимаций AnimationFly

## 1. Введение

`AnimationFly` — это мощный синглтон-менеджер для создания эффекта "летящих" UI-элементов. Он идеально подходит для анимации сбора наград, монет или любых других ресурсов, которые должны переместиться из одной точки экрана в другую.

Система использует DOTween для плавных и настраиваемых анимаций, поддерживает разные типы "бонусов" через префабы и умеет корректно работать с разными пространствами координат (мировые и Canvas).

---

## 2. Описание класса

### AnimationFly
- **Пространство имен**: `Neo`
- **Путь к файлу**: `Assets/Neoxider/Scripts/UI/AnimationFly.cs`

**Описание**
Класс-синглтон, который управляет созданием и анимацией летящих объектов от начальной до конечной точки.

### Публичные поля (настраиваемые в инспекторе)
- `spawnParent`: `Transform` - Родительский объект, внутри которого будут создаваться летящие элементы.
- `parentCanvas`: `Canvas` - Родительский Canvas, используется для корректных расчетов координат.
- `scaleMult`: `float` - Множитель размера для спавнящихся объектов.
- `ignoreZ`: `bool` - Если `true`, Z-координата будет игнорироваться.
- `countMultiplier`: `float` - **(Новое)** Множитель для количества создаваемых объектов. Позволяет уменьшать или увеличивать количество летящих частиц. По умолчанию `1`.
- `maxBonusCount`: `int` - **(Новое)** Максимальное количество объектов, которое может быть создано за один вызов `Execute`. Ограничивает `bonusCount` после применения `countMultiplier`. По умолчанию `1000`.

#### Настройки анимации
- `flyDuration`: `float` - Длительность полета одного объекта в секундах.
- `delayBetweenBonuses`: `float` - Задержка между созданием каждого следующего объекта.
- `arcStrength`: `float` - Сила "дуги" полета. Отвечает за смещение средней точки траектории.
- `multY`: `float` - Дополнительный множитель для смещения по оси Y.
- `useUnscaledTime`: `bool` - Использовать ли `Time.unscaledTime` для анимации.
- `middlePoint`: `float` - Средняя точка траектории (от 0 до 1).
- `easyStart`, `easyEnd`: `Ease` - Кривые замедления для начала и конца полета (DOTween).

### Структура BonusPrefabData

```csharp
[Serializable]
public struct BonusPrefabData
{
    public int bonusType;
    public GameObject prefab;
    public Transform endPos;
    public bool isWorldSpace; // Указывает, находится ли конечная позиция в мировом пространстве (true) или в пространстве Canvas (false).
}
```
- `bonusType`: `int` - Уникальный идентификатор типа бонуса.
- `prefab`: `GameObject` - Префаб объекта, который будет анимироваться.
- `endPos`: `Transform` - Конечная точка, куда будет лететь объект.
- `isWorldSpace`: `bool` - Флаг, указывающий, находится ли `endPos` в мировом пространстве (`true`) или в пространстве Canvas (`false`).

`bonusPrefabList`: `List<BonusPrefabData>` - Список данных о префабах бонусов и их конечных точках. Используется для настройки различных типов бонусов через инспектор.

### Публичные методы
- `Execute(...)`: Набор перегруженных методов для запуска анимации. Принимают тип бонуса, количество, начальную/конечную позицию и колбэки.
- `AnimationRoutine(...)`: Публичная корутина, выполняющая основную логику анимации. Возвращает `IEnumerator`.
- `GetPrefab(int type)`: Находит и возвращает префаб для указанного типа бонуса. Возвращает `GameObject` или `null`, если тип не найден.
- `GetPos(int type)`: Находит и возвращает конечную точку (Transform) для указанного типа бонуса. Возвращает `Transform` или `null`.
- `CanvasToWorldPosition(Vector2 uiPosition, ...)`: Статический метод для конвертации позиции из пространства Canvas в мировые координаты. Возвращает `Vector3`.
- `WorldToCanvasPosition(Vector3 worldPosition, ...)`: Статический метод для конвертации мировой позиции в позицию на Canvas. Возвращает `Vector2`.