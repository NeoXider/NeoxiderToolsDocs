# Модуль Shop

## 1. Введение

Модуль **Shop** предоставляет полноценную систему внутриигрового магазина. Он позволяет легко создавать, настраивать и управлять товарами, обрабатывать покупки и обновлять пользовательский интерфейс. Система гибко работает с валютой через компонент `Money` и позволяет как разовые, так и многоразовые покупки.

Основная цель модуля — предоставить готовое решение для быстрой интеграции магазина в игру, сокращая время на разработку стандартной логики покупок и сохранения данных.

---

## 2. Описание классов

### Money
- **Пространство имен**: `Neo.Shop`
- **Путь к файлу**: `Assets/Neoxider/Scripts/Shop/Money.cs`

**Описание**
`Money` — это класс-синглтон, отвечающий за управление всеми денежными операциями в игре. Он отслеживает общий баланс, деньги, заработанные за уровень, и автоматически сохраняет данные между сессиями.

**Ключевые особенности**
- **Два типа баланса**: `money` (общий) и `levelMoney` (заработанный за текущий уровень).
- **Сохранение и загрузка**: Автоматически сохраняет баланс в `PlayerPrefs`.
- **Интеграция с UI**: Может напрямую обновлять текстовые поля `TextMeshPro`.
- **События**: Уведомляет другие системы об изменении баланса через `UnityEvent`.

**Публичные методы**
- `AddLevelMoney(float count)`: Добавляет деньги к балансу текущего уровня.
- `SetLevelMoney(float count = 0)`: Устанавливает баланс уровня в указанное значение. Возвращает `float` — сумму, которая была на балансе до сброса.
- `SetMoneyForLevel(bool resetLevelMoney = true)`: Переводит деньги, заработанные за уровень, на основной баланс. Возвращает `float` — переведенную сумму.
- `CanSpend(float count)`: Проверяет, достаточно ли денег для совершения покупки. Возвращает `bool`.
- `Spend(float count)`: Списывает указанное количество денег с основного баланса. Возвращает `bool` — `true` в случае успеха и `false`, если средств недостаточно.
- `Add(float count)`: Начисляет деньги на основной баланс.

**Unity Events**
- `OnChangedLevelMoney`: Вызывается при изменении баланса за уровень. Передает `float` (новый баланс).
- `OnChangedMoney`: Вызывается при изменении основного баланса. Передает `float` (новый баланс).
- `OnChangeLastMoney`: Вызывается при любом изменении баланса. Передает `float` (сумма последнего изменения).
- `OnChangeAllMoney`: Вызывается при добавлении денег. Передает `float` (общая сумма заработанных денег за все время).

---

### Shop
- **Пространство имен**: `Neo.Shop`
- **Путь к файлу**: `Assets/Neoxider/Scripts/Shop/Shop.cs`

**Описание**
`Shop` — это главный компонент, управляющий логикой магазина. Он организует товары, обрабатывает покупки и обновляет их визуальное представление.

**Публичные методы**
- `ShowPreview(int id)`: Отображает превью товара по его `id`.
- `Buy(int id)`: Совершает покупку товара по `id`.
- `Buy()`: Совершает покупку выбранного в превью товара.
- `Visual()`: Обновляет визуальное состояние всех товаров в магазине.

**Unity Events**
- `OnSelect`: Вызывается при выборе товара. Передает `int` (`id` товара).
- `OnPurchased`: Вызывается при успешной покупке. Передает `int` (`id` купленного товара).
- `OnPurchaseFailed`: Вызывается при неудачной попытке покупки (недостаточно средств). Передает `int` (`id` товара).
- `OnLoad`: Вызывается после загрузки сохраненных данных о ценах.

---

### ShopItemData
- **Пространство имен**: `Neo.Shop`
- **Путь к файлу**: `Assets/Neoxider/Scripts/Shop/ShopItemData.cs`

**Описание**
`ShopItemData` — это `ScriptableObject`, который хранит всю информацию о товаре: его название, цену, иконки и тип покупки (одноразовая или нет).

**Ключевые особенности**
- **Централизованное хранение**: Позволяет легко настраивать товары в инспекторе Unity.
- **Гибкость**: Один и тот же товар можно использовать в разных магазинах.

---

### ShopItem
- **Пространство имен**: `Neo.Shop`
- **Путь к файлу**: `Assets/Neoxider/Scripts/Shop/ShopItem.cs`

**Описание**
`ShopItem` — это компонент, отвечающий за визуальное представление одного товара в UI. Он отображает данные из `ShopItemData` и реагирует на действия пользователя.

**Публичные методы**
- `Visual(ShopItemData shopItemData, int price)`: Обновляет внешний вид элемента (название, цена, иконка) на основе данных.
- `Select(bool active)`: Устанавливает визуальное состояние "выбран" или "не выбран".

**Unity Events**
- `OnSelectItem`: Вызывается, когда элемент становится выбранным.
- `OnDeselectItem`: Вызывается, когда с элемента снимается выбор.

---

### TextMoney
- **Пространство имен**: `Neo.Shop`
- **Путь к файлу**: `Assets/Neoxider/Scripts/Shop/TextMoney.cs`

**Описание**
`TextMoney` — это удобный UI-компонент для отображения текущего баланса. Он автоматически подписывается на события класса `Money` и обновляет текстовое поле, избавляя от необходимости писать эту логику вручную.

---

### Интерфейсы (IMoneySpend, IMoneyAdd)
- **Пространство имен**: `(глобальное)`
- **Путь к файлу**: `Assets/Neoxider/Scripts/Shop/InterfaceMoney.cs`

**Описание**
Эти интерфейсы используются для реализации паттерна "инверсия зависимостей". Компонент `Shop` зависит не от конкретного класса `Money`, а от этих интерфейсов. Это позволяет в будущем легко подменить систему валюты, не изменяя код магазина.
- `IMoneySpend`: Определяет метод `Spend(float count)`, который должен возвращать `bool` (результат операции).
- `IMoneyAdd`: Определяет метод `Add(float count)`.
