
# Система уровней (Level)

## Описание

Модуль **Level** предоставляет комплексную систему для управления игровой прогрессией. Он позволяет организовать уровни в виде "карт" (миров), отслеживать прогресс игрока (какой уровень открыт), сохранять эти данные и управлять пользовательским интерфейсом для выбора уровней.

Эта система является центральным элементом для игр с поэтапным прохождением.

## Ключевые компоненты

### `LevelManager`
**Пространство имен:** `Neo.Level`

Это основной класс-синглтон, который управляет всей логикой уровней. Он выступает в роли координатора между данными о прогрессе и их визуальным представлением.

- **Как использовать**: Разместите этот компонент на персистентном объекте на сцене (например, на игровом менеджере).
- **Основные обязанности**:
  - Управляет массивом объектов `Map`, каждый из которых представляет собой отдельный мир или набор уровней.
  - Отслеживает текущий выбранный уровень (`CurrentLevel`) и максимальный достигнутый уровень на каждой карте (`MaxLevel`).
  - Сохраняет и загружает прогресс игрока с использованием `PlayerPrefs`.
  - Управляет визуальным состоянием кнопок `LevelButton`.
- **Ключевые методы**:
  - `SetLevel(int idLevel)`: Загружает указанный уровень.
  - `NextLevel()`: Переходит к следующему уровню.
  - `Restart()`: Перезапускает текущий уровень.
  - `SaveLevel()`: Сохраняет прогресс, увеличивая максимальный доступный уровень. Этот метод нужно вызывать после успешного прохождения уровня.
- **Unity Events**:
  - `OnChangeLevel(int)`: Вызывается при смене текущего уровня. Передает номер нового уровня. Сюда можно подключить логику загрузки сцен.
  - `OnChangeMaxLevel(int)`: Вызывается, когда открывается новый уровень.
  - `OnChangeMap(int)`: Вызывается при смене активной карты.

### `Map`
**Пространство имен:** `Neo.Level`

Это не `MonoBehaviour`, а сериализуемый класс данных, который описывает одну "карту" или мир.

- **Свойства**:
  - `countLevels` (`int`): Общее количество уровней на этой карте.
  - `level` (`int`): Максимальный уровень, достигнутый игроком на этой карте.
  - `isInfinity` (`bool`): Если `true`, карта считается бесконечной, и игрок всегда может перейти на следующий уровень.
  - `isLoopLevel` (`bool`): Если `true`, после последнего уровня игрок вернется к первому.

### `LevelButton`
**Пространство имен:** `Neo.Level`

UI-компонент, который следует размещать на кнопках выбора уровня.

- **Принцип работы**: Каждая кнопка `LevelButton` связана с `LevelManager`. Менеджер автоматически обновляет состояние кнопок, делая их доступными, недоступными или отмечая как текущий уровень.
- **Настройка**: Просто разместите кнопки на сцене и укажите их родительский объект в поле `_parentLevel` у `LevelManager`, чтобы он нашел их автоматически.
- **Unity Events**:
  - `OnDisableVisual`: Вызывается, если уровень заблокирован.
  - `OnEnableVisual`: Вызывается, если уровень пройден.
  - `OnCurrentVisual`: Вызывается, если это текущий не пройденный уровень.

## Пример использования

1.  Создайте пустой `GameObject` и добавьте на него компонент `LevelManager`.
2.  В инспекторе `LevelManager` настройте массив `Maps`. Для каждой карты укажите общее количество уровней.
3.  Создайте экран выбора уровней, используя `Button` с компонентом `LevelButton` для каждого уровня.
4.  В `LevelManager` укажите родительский объект для этих кнопок в поле `_parentLevel`.
5.  В вашей игровой логике после успешного завершения уровня вызовите `LevelManager.I.SaveLevel()`.
6.  Для загрузки уровней используйте `LevelManager.I.SetLevel(id)` или `NextLevel()`. Подпишитесь на событие `OnChangeLevel`, чтобы реализовать саму логику переключения сцен (`SceneManager.LoadScene`).
