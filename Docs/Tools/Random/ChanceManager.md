# Компонент Chance Manager

## 1. Введение

`ChanceManager` — это мощный инструмент для создания систем, основанных на вероятностях. Он позволяет вам определить набор "шансов" (вероятностей) для различных исходов, а затем легко выбрать один из них случайным образом, учитывая заданные веса. 

Это незаменимо для реализации таких механик, как:
- **Выпадение лута**: С какой вероятностью выпадет обычный, редкий или эпический предмет.
- **Спавн врагов**: С какой вероятностью появится слабый, средний или сильный противник.
- **События**: С какой вероятностью произойдет то или иное событие.

---

## 2. Структура данных

### Chance
Простой класс, который представляет собой одну вероятность.
- `value` (`float`): Значение вероятности (от 0 до 1). В инспекторе отображается как слайдер.

---

## 3. Описание класса

### ChanceManager
- **Пространство имен**: `Neo.Tools`
- **Путь к файлу**: `Assets/Neoxider/Scripts/Tools/Random/ChanceManager.cs`

**Описание**
Этот класс управляет списком объектов `Chance`. Он автоматически нормализует все вероятности в списке так, чтобы их сумма всегда была равна 1. Это гарантирует, что при случайном выборе всегда будет выбран один из вариантов.

**Ключевые поля**
- `chances` (`List<Chance>`): Список всех вероятностей. Вы можете добавлять и настраивать их прямо в инспекторе.
- `preserveFirstChance` (`bool`): **Важная настройка для балансировки!**
  - Если `true`: Первое значение в списке `chances` сохранит свое точное значение, а остальные вероятности будут пропорционально масштабированы, чтобы сумма всех шансов была равна 1.
  - Если `false`: Последнее значение в списке `chances` сохранит свое точное значение, а остальные вероятности будут пропорционально масштабированы.

**Публичные методы (Public Methods)**
- `AddChance(float chance)`: Добавляет новую вероятность в список. После добавления список автоматически нормализуется.
- `RemoveChance(int index)`: Удаляет вероятность по индексу и пересчитывает остальные.
- `GetChanceId()`: **Основной метод для использования.** Возвращает случайный индекс из списка `chances` на основе их вероятностей. Например, если у вас 3 шанса (0.7, 0.2, 0.1), то с 70% вероятностью вернется 0, с 20% — 1, с 10% — 2.
- `GetChanceValue(int index)`: Возвращает текущее нормализованное значение вероятности по индексу.
- `SetChanceValue(int index, float value)`: Устанавливает новое значение вероятности по индексу и запускает нормализацию.

---

## 4. Как использовать

### 4.1. Настройка в инспекторе
1.  Создайте пустой `GameObject` и добавьте на него компонент `ChanceSystemBehaviour` (который использует `ChanceManager`).
2.  В инспекторе `ChanceSystemBehaviour` найдите поле `chances`.
3.  Увеличьте `Size` и для каждого элемента задайте `Value` (например, 0.5 для 50%, 0.3 для 30% и 0.2 для 20%). Менеджер автоматически нормализует их.
4.  Настройте `preserveFirstChance` по необходимости.

### 4.2. Использование в коде

```csharp
using Neo.Tools;
using UnityEngine;

public class LootDropper : MonoBehaviour
{
    public ChanceManager lootChances = new ChanceManager();

    void Start()
    {
        // Добавляем шансы (можно и в инспекторе)
        lootChances.AddChance(0.7f); // Обычный предмет
        lootChances.AddChance(0.2f); // Редкий предмет
        lootChances.AddChance(0.1f); // Легендарный предмет

        // Или настраиваем в инспекторе и используем уже готовый список
    }

    public void DropItem()
    {
        int droppedItemId = lootChances.GetChanceId();

        switch (droppedItemId)
        {
            case 0: Debug.Log("Выпал обычный предмет!"); break;
            case 1: Debug.Log("Выпал редкий предмет!"); break;
            case 2: Debug.Log("Выпал легендарный предмет!"); break;
        }
    }
}
```
