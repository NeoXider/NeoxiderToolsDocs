# EM (Event Manager)

## 1. Введение

`EM` (сокращение от Event Manager) — это глобальный "центр сообщений" для всей вашей игры. Он реализован как синглтон и предоставляет набор стандартных событий (`UnityEvent`), соответствующих ключевым моментам в игровом цикле: начало игры, победа, поражение, пауза и т.д.

Основная идея этого менеджера — полностью отделить игровую логику от ее последствий. Например, скрипт, отвечающий за здоровье босса, при его смерти не должен знать о существовании UI-панели победы или аудио-менеджера. Он просто сообщает всему миру: "Мы победили!", вызывая `EM.Win()`. А уже панель победы и аудио-менеджер, будучи подписанными на событие `OnWin` в инспекторе `EM`, отреагируют на это так, как им нужно.

---

## 2. Описание класса

### EM
- **Пространство имен**: `Neo`
- **Путь к файлу**: `Assets/Neoxider/Scripts/Tools/Managers/EM.cs`

**Описание**
Синглтон, который содержит коллекцию `UnityEvent` для глобальных игровых состояний. Предоставляет статические методы для вызова этих событий из любого места в коде.

**Ключевые события (Unity Events)**

- **Игровой цикл**:
  - `OnMenu`: Переход в главное меню.
  - `OnPreparing`: Подготовка к началу игры.
  - `OnGameStart`: Начало игрового процесса.
  - `OnRestart`: Перезапуск уровня.
  - `OnWin`: Событие победы.
  - `OnLose`: Событие поражения.
  - `OnEnd`: Завершение игры (общее событие после победы или поражения).

- **Пауза**:
  - `OnPause`: Игра поставлена на паузу.
  - `OnResume`: Игра снята с паузы.

- **События приложения**:
  - `OnFocusApplication`, `OnPauseApplication`, `OnQuitApplication`: Обертки над стандартными событиями `Application` в Unity, позволяющие реагировать на них из инспектора.

---

## 3. Как использовать

Существует два способа взаимодействия с `EM`:

### 1. Прослушивание событий (из инспектора)
Это основной способ реакции на события. Например, чтобы показать панель победы:
1.  Найдите на сцене объект с компонентом `EM`.
2.  В инспекторе найдите событие `OnWin`.
3.  Нажмите `+` и перетащите вашу панель победы в поле объекта.
4.  В выпадающем списке выберите `GameObject` -> `SetActive(bool)` и поставьте галочку.

Теперь, когда кто-угодно в коде вызовет `EM.Win()`, ваша панель автоматически активируется.

### 2. Вызов событий (из кода)
Чтобы вызвать событие, просто используйте соответствующий статический метод. Вам не нужна ссылка на экземпляр класса.

```csharp
// Пример в скрипте, который определяет условия победы
public void CheckWinCondition()
{
    if (player.Score > 1000)
    {
        // Просто сообщаем всему миру о победе
        EM.Win();
    }
}
```

**Зависимости**
- Является синглтоном и наследуется от `Neo.Tools.Singleton<EM>`.
- Имеет событие `OnStateChange`, которое зависит от `GM.GameState`, что подразумевает тесную связь с `GM` (GameManager).
