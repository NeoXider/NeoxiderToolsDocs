# GM (Game Manager)

## 1. Введение

`GM` (сокращение от GameManager) — это главный "мозг" и машина состояний вашей игры. Он является единственным источником правды о том, в каком состоянии находится игра в данный момент: в меню, в процессе игры, на экране победы и т.д. 

Этот компонент работает в неразрывной связке с `EM` (EventManager). Их роли четко разделены:
- **`GM` — устанавливает состояние.** Когда нужно проиграть, вы вызываете `GM.I.Lose()`.
- **`EM` — объявляет об этом состоянии.** Метод `GM.I.Lose()` внутри себя вызовет `EM.Lose()`, на который уже подписаны другие модули (UI, звук и т.д.).

Такое разделение делает архитектуру чистой и предсказуемой.

---

## 2. Состояния игры (GameState)

`GameState` — это перечисление (enum), которое определяет все возможные состояния игры:
- `NotStarted`
- `Menu`
- `Preparing`
- `Game`
- `Win`
- `Lose`
- `End`
- `Pause`
- `Other`

---

## 3. Описание класса

### GM
- **Пространство имен**: `Neo.Tools`
- **Путь к файлу**: `Assets/Neoxider/Scripts/Tools/Managers/GM.cs`

**Описание**
Синглтон, который управляет жизненным циклом игры. Он содержит методы для перехода между всеми состояниями `GameState` и вызывает соответствующие события в `EM`.

**Ключевые свойства и поля**
- `State` (`GameState`): Свойство для получения или установки текущего состояния игры. При установке нового значения автоматически вызывается событие `EM.I.OnStateChange`.
- `IsPlaying` (`bool`): Удобное свойство для быстрой проверки, находится ли игра в состоянии `Game`.
- `useTimeScalePause` (`bool`): Если `true`, при вызове `Pause()` время в игре (`Time.timeScale`) автоматически установится на 0, а при вызове `Resume()` — вернется к предыдущему значению.
- `fps` (`int`): Целевая частота кадров, которая будет установлена при инициализации игры.

**Публичные методы**
Компонент предоставляет публичные виртуальные методы для перехода в каждое из состояний. Основные из них:
- `StartGame()`: Переводит игру в состояние `Game` и вызывает `EM.GameStart()`.
- `Win()`: Переводит игру в состояние `Win` и вызывает `EM.Win()`.
- `Lose()`: Переводит игру в состояние `Lose` и вызывает `EM.Lose()`.
- `Pause()`: Ставит игру на паузу.
- `Resume()`: Снимает игру с паузы.
- `Menu()`: Переводит игру в состояние `Menu`.

---

## 4. Как использовать

1.  Поместите компонент `GM` на постоянный объект-менеджер на вашей сцене (тот же, где находится `EM`).
2.  Из любого другого скрипта, где нужно изменить состояние игры, обращайтесь к синглтону `GM` и вызывайте его методы.

    ```csharp
    // Пример в скрипте здоровья игрока
    public void TakeDamage(int amount)
    {
        health -= amount;
        if (health <= 0)
        {
            // Игрок проиграл. Меняем глобальное состояние игры.
            GM.I.Lose();
        }
    }
    ```
3.  Для **реакции** на смену состояний используйте события из `EM`, как описано в его документации.
