# Компонент AI Navigation

## 1. Введение

`AiNavigation` — это высокоуровневый компонент для управления перемещением AI-агентов в Unity с использованием системы NavMesh. Он предоставляет удобный интерфейс для задания целей, контроля скорости, обработки анимаций и реагирования на различные события навигации, такие как достижение цели или блокировка пути.

Этот инструмент значительно упрощает создание сложного поведения для NPC, позволяя сосредоточиться на логике, а не на низкоуровневых деталях работы с `NavMeshAgent`.

---

## 2. Описание класса

### AiNavigation
- **Пространство имен**: Глобальное
- **Путь к файлу**: `Assets/Neoxider/Scripts/Tools/Other/AiNavigation.cs`
- **Требуемые компоненты**: `NavMeshAgent`, `Animator`

**Описание**
Компонент, который управляет `NavMeshAgent` для перемещения объекта по NavMesh. Он также синхронизирует движение с аниматором и предоставляет события для отслеживания статуса навигации.

### 2.1. Настройки навигации
- `target` (`Transform`): Цель, за которой должен следовать агент. Если задана, агент будет постоянно обновлять путь к ней.
- `stoppingDistance`: Расстояние до цели, на котором агент остановится.
- `updateRotation`: Если `true`, агент будет автоматически поворачиваться в сторону движения.

### 2.2. Настройки движения
- `baseSpeed`: Базовая скорость движения агента.
- `sprintSpeedMultiplier`: Множитель скорости при включении режима спринта.
- `acceleration`: Ускорение агента.
- `turnSpeed`: Скорость поворота агента.

### 2.3. Настройки пути
- `autoUpdatePath`: Если `true`, агент будет автоматически пересчитывать путь к цели через заданные интервалы.
- `pathUpdateInterval`: Интервал в секундах для автоматического обновления пути.
- `maxPathLength`: Максимальная длина пути, используемая при поиске пути.

### 2.4. Настройки анимации
- `speedParameterName`: Имя float-параметра в `Animator`, который будет обновляться скоростью движения агента.
- `isMovingParameterName`: Имя bool-параметра в `Animator`, который будет `true`, если агент движется.
- `animationDampTime`: Время сглаживания для параметров анимации.

### 2.5. Публичные свойства
- `Target`: Текущая цель навигации.
- `HasReachedDestination`: `true`, если агент достиг цели.
- `IsPathBlocked`: `true`, если текущий путь заблокирован.
- `PathStatus`: Текущий статус пути (`NavMeshPathStatus`).
- `RemainingDistance`: Оставшееся расстояние до цели.
- `CurrentSpeed`: Текущая скорость агента.

### 2.6. Публичные методы
- `SetTarget(Transform newTarget)`: Устанавливает новую цель для навигации.
- `SetDestination(Vector3 destination)`: Устанавливает новую позицию для навигации.
- `SetSpeed(float multiplier)`: Изменяет скорость агента.
- `EnableSprint(bool enable)`: Включает/выключает режим спринта.
- `Stop()`: Немедленно останавливает агента.
- `Resume()`: Возобновляет движение агента.
- `WarpToPosition(Vector3 position)`: Телепортирует агента в указанную позицию на NavMesh.
- `IsPositionReachable(Vector3 position)`: Проверяет, достижима ли указанная позиция.
- `GetPathToPosition(Vector3 position)`: Возвращает вычисленный путь до позиции.

### 2.7. Unity Events
- `OnDestinationReached`: Вызывается, когда агент достигает цели.
- `OnPathBlocked`: Вызывается, когда путь агента становится заблокированным.
- `OnSpeedChanged`: Вызывается при изменении скорости агента.
- `OnPathUpdated`: Вызывается при обновлении пути агента.
- `OnPathStatusChanged`: Вызывается при изменении статуса пути.

---

## 3. Как использовать

1.  **Запеките NavMesh**: Убедитесь, что в вашей сцене запечен NavMesh (Window -> AI -> Navigation).
2.  **Добавьте компоненты**: На ваш AI-персонаж добавьте компоненты `NavMeshAgent` и `Animator`.
3.  **Добавьте `AiNavigation`**: Добавьте компонент `AiNavigation` на тот же `GameObject`.
4.  **Настройте аниматор**: В `Animator` вашего персонажа создайте float-параметр с именем, указанным в `speedParameterName` (по умолчанию "Speed"), и bool-параметр с именем из `isMovingParameterName` (по умолчанию "IsMoving"). Используйте их для управления анимациями ходьбы/бега.
5.  **Задайте цель**: Либо перетащите `Transform` цели в поле `target` в инспекторе, либо вызывайте `SetDestination(Vector3)` из другого скрипта.
