
# Система Сохранения (Save)

## Описание

Модуль **Save** предоставляет несколько гибких механизмов для сохранения и загрузки игровых данных. Он построен на основе `PlayerPrefs`, но предлагает более структурированные и автоматизированные подходы для разных задач: от сохранения отдельных полей в компонентах до управления глобальным состоянием игры.

## 1. Основная система (SaveManager)

Это наиболее мощная и рекомендуемая часть модуля. Она позволяет автоматически сохранять и загружать поля в любых компонентах.

### Принцип работы

Система работает на связке из трех ключевых элементов:
1.  **`SaveManager`**: Синглтон-менеджер, который управляет всем процессом. Он находит все сохраняемые объекты, загружает их состояние при старте и сохраняет при выходе.
2.  **`ISaveableComponent`**: Интерфейс, которым нужно пометить любой `MonoBehaviour`, чтобы `SaveManager` начал с ним работать.
3.  **`[SaveField]`**: Атрибут, которым нужно пометить конкретные поля внутри компонента, которые вы хотите сохранить.

### Как использовать

1.  **Добавьте `SaveManager`**: Убедитесь, что на вашей стартовой сцене есть объект с компонентом `SaveManager`. Если его нет, он создастся сам при первом обращении.
2.  **Пометьте компонент**: В скрипте, данные которого нужно сохранить, реализуйте интерфейс `ISaveableComponent`.
3.  **Пометьте поля**: В этом же скрипте поставьте атрибут `[SaveField("УникальныйКлюч")]` над каждой переменной, которую нужно сохранять.
4.  **(Опционально) Унаследуйтесь от `SaveableBehaviour`**: Чтобы ваш компонент автоматически регистрировался в `SaveManager` даже при создании во время игры, унаследуйте его от `SaveableBehaviour` вместо `MonoBehaviour`.

### Ключевые классы и атрибуты

#### `SaveManager`
- **Описание**: Центральный менеджер. Является "ленивым" синглтоном. Автоматически загружает данные при инициализации и сохраняет при выходе из приложения.
- **Публичные методы**:
  - `Save()`: Принудительно сохраняет состояние **всех** зарегистрированных объектов. Полезно для контрольных точек.
  - `Save(MonoBehaviour monoObj)`: Принудительно сохраняет состояние **одного** конкретного объекта.
  - `Load(MonoBehaviour monoObj)`: Принудительно загружает состояние для **одного** конкретного объекта.

#### `ISaveableComponent`
- **Описание**: Интерфейс-маркер. Просто добавьте его к вашему классу, чтобы `SaveManager` мог его найти.
- **Методы**:
  - `void OnDataLoaded()`: Этот метод будет вызван на вашем компоненте **сразу после** того, как `SaveManager` загрузит в него все сохраненные данные. Используйте его для применения загруженных данных (например, для обновления позиции объекта, здоровья и т.д.).

#### `[SaveField]`
- **Описание**: Атрибут для пометки полей, которые нужно сохранить.
- **Параметры**:
  - `key` (`string`): Обязательный. Уникальный ключ для этого поля.
  - `autoSaveOnQuit` (`bool`): `true` по умолчанию. Сохранять ли поле при выходе.
  - `autoLoadOnAwake` (`bool`): `true` по умолчанию. Загружать ли поле при старте.

#### `SaveableBehaviour`
- **Описание**: Абстрактный базовый класс, от которого можно наследоваться вместо `MonoBehaviour`. Он уже реализует `ISaveableComponent` и автоматически регистрирует/отменяет регистрацию компонента в `SaveManager` при его включении/выключении на сцене. Это самый надежный способ работы с системой.

--- 

## 2. Глобальное сохранение (GlobalSave)

Это более простая система для хранения одного глобального объекта с данными, доступного из любой точки кода.

### Принцип работы

- **`GlobalSave`**: Статический класс, который не требует наличия на сцене. Он управляет сохранением и загрузкой одного экземпляра класса `GlobalData`.
- **`GlobalData`**: Класс-контейнер для ваших данных. Изначально он пуст, вы должны сами добавить в него нужные поля (например, `public int coins;`).

### Как использовать

1.  Добавьте нужные поля в класс `GlobalData.cs`.
2.  Для доступа к данным из любого скрипта используйте `GlobalSave.data`.
3.  Присвоение нового значения `GlobalSave.data = myData;` автоматически сохраняет данные.


